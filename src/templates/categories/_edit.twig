{% extends 'pragmatic-cookies/_layout' %}
{% import "_includes/forms" as forms %}

{% set selectedTab = 'categories' %}
{% set _siteHandle = craft.app.request.getQueryParam('site') %}
{% set _siteParam = _siteHandle ? { site: _siteHandle } : {} %}
{% set _localizableTitle = 'This field is translated for each site.'|t('app') %}
{% set _localizableIcon = '<span class="localizable icon" data-icon="world" title="' ~ _localizableTitle|e('html_attr') ~ '" aria-label="' ~ _localizableTitle|e('html_attr') ~ '"></span>' %}

{% set crumbs = [
  { label: 'Cookies'|t('pragmatic-cookies'), url: url('pragmatic-cookies', _siteParam) },
  { label: 'Categories'|t('pragmatic-cookies'), url: url('pragmatic-cookies/categories', _siteParam) },
] %}

{% block content %}
  <form method="post" accept-charset="UTF-8">
    {{ csrfInput() }}
    {{ actionInput('pragmatic-cookies/default/save-category') }}
    {{ redirectInput('pragmatic-cookies/categories', _siteParam) }}
    {{ hiddenInput('site', selectedSiteId ?? craft.app.sites.currentSite.id) }}

    {% if category.id %}
      {{ hiddenInput('categoryId', category.id) }}
    {% endif %}

    {{ forms.textField({
      label: ('Name'|t('pragmatic-cookies') ~ ' ' ~ _localizableIcon)|raw,
      id: 'name',
      name: 'name',
      value: category.name,
      required: true,
      first: true,
      errors: category.getErrors('name'),
    }) }}

    {{ forms.textField({
      label: 'Handle'|t('pragmatic-cookies'),
      id: 'handle',
      name: 'handle',
      value: category.handle,
      required: true,
      instructions: 'Used in code references (e.g. "analytics", "marketing").'|t('pragmatic-cookies'),
      errors: category.getErrors('handle'),
    }) }}

    {{ forms.textareaField({
      label: ('Description'|t('pragmatic-cookies') ~ ' ' ~ _localizableIcon)|raw,
      id: 'description',
      name: 'description',
      value: category.description,
      rows: 3,
      instructions: 'Shown to visitors in the consent popup.'|t('pragmatic-cookies'),
    }) }}

    {{ forms.lightswitchField({
      label: 'Required'|t('pragmatic-cookies'),
      id: 'isRequired',
      name: 'isRequired',
      on: category.isRequired,
      instructions: 'Required categories cannot be disabled by visitors.'|t('pragmatic-cookies'),
    }) }}

    <div class="btngroup">
      <button type="submit" class="btn submit">{{ 'Save'|t('pragmatic-cookies') }}</button>
    </div>
  </form>

  {% if not category.id %}
    {% js %}
      new Craft.HandleGenerator('#name', '#handle');
    {% endjs %}
  {% endif %}
{% endblock %}
